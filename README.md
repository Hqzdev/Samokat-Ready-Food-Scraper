# Скрейпер готовой еды (Самокат / Лавка / ВкусВилл)

Кроссплатформенный Python-проект для сбора базы готовой еды с трех сервисов доставки.

## Особенности

- **Антибот-защита**: Ротация заголовков, повторы с экспоненциальной паузой, rate-limiting
- **Дедупликация**: Автоматическое удаление дубликатов по (shop, id)
- **Валидация**: Проверка качества данных и заполненности БЖУ
- **Экспорт**: CSV (UTF-8, ; как разделитель) и JSONL
- **Чекпоинты**: Возможность продолжения с места остановки

## Установка

```bash
# Клонирование репозитория
git clone <repository-url>
cd Samokat-Ready-Food-Scraper

# Установка зависимостей
pip install -r requirements.txt
```

## Использование

### Основные команды

```bash
# ВкусВилл (рекомендуется для 500+ позиций)
python main.py --shop vkusvill --city "Москва" --limit -1 --out data/vv.csv

# Самокат с геопривязкой
python main.py --shop samokat --city "Москва" --coords "55.75,37.61" --out data/samokat.csv

# Лавка в бережном режиме
python main.py --shop lavka --city "Москва" --out data/lavka.csv --concurrency 2

# Все магазины сразу
python main.py --shop all --city "Москва" --out data/all_shops.csv --jsonl data/all_shops.jsonl
```

### Параметры

- `--shop`: vkusvill|samokat|lavka|all (по умолчанию vkusvill)
- `--city`: Город для геопривязки
- `--coords`: Координаты "широта,долгота"
- `--limit`: Количество товаров (-1 = без лимита)
- `--out`: Путь к CSV файлу
- `--jsonl`: Путь к JSONL файлу (опционально)
- `--download-photos`: 0/1 - скачивать фото (по умолчанию 0)
- `--concurrency`: Количество одновременных задач (по умолчанию 8)
- `--proxy`: Прокси SOCKS/HTTP (опционально)
- `--timeout`: Таймаут запросов (по умолчанию 30)
- `--verbose`: Подробное логирование

## Формат данных

Выгружаемые поля (в порядке):

| Поле | Описание | Тип |
|------|----------|-----|
| id | Стабильный ID товара | string |
| name | Название товара | string |
| category | Категория (хлебные крошки) | string |
| kcal_100g | Калории на 100г | float |
| protein_100g | Белки на 100г | float |
| fat_100g | Жиры на 100г | float |
| carb_100g | Углеводы на 100г | float |
| portion_g | Масса порции в граммах | float |
| price | Цена в рублях | float |
| shop | Магазин (vkusvill/samokat/lavka) | string |
| tags | Теги через ; | string |
| composition | Состав | string |
| url | Ссылка на карточку | string |
| photo | URL фото | string |

## Стратегия достижения 500+ позиций

### ВкусВилл (основной источник)
- Обход всех подкатегорий "Готовой еды"
- Включает: вторые блюда, салаты, супы, диетические блюда, новинки
- Стабильно дает 500+ позиций за проход

### Самокат
- SPA-интерфейс с геозависимостью
- Требует установки города/координат
- Возможны ограничения без JS-рендеринга

### Лавка
- Агрессивная антибот-защита (SmartCaptcha)
- Бережный режим: редкие запросы, высокий таймаут
- Ограниченный объем без headless браузера

## Логирование

Все операции логируются в файл `scraper.log` и консоль:
- Успешные запросы
- Ошибки и предупреждения
- Статистика сбора
- Проблемы с валидацией

## Примеры вывода

```bash
============================================================
СКРЕЙПИНГ ЗАВЕРШЕН
============================================================
Всего товаров: 523
С заполненным БЖУ-100г: 487
Без БЖУ-100г: 36
Дубликатов: 12
Невалидных: 8
Доля с БЖУ: 93.1%

Топ-категории:
  Вторые блюда: 156
  Салаты: 89
  Супы: 67
  Диетические блюда: 45
  Новинки: 38
============================================================
```

## Устранение проблем

### Блокировка запросов
- Уменьшите `--concurrency` до 2-4
- Используйте `--proxy` для ротации IP
- Увеличьте `--timeout` до 60

### Мало товаров (< 300)
- Проверьте доступность сайта
- Убедитесь в корректности города
- Попробуйте другой магазин

### Ошибки парсинга
- Включите `--verbose` для детального логирования
- Проверьте изменения в структуре сайтов
- Обновите селекторы в скрейперах

## Лицензия

MIT License

